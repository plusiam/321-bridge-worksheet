<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3-2-1 Bridge í•™ìŠµ ë„êµ¬ Enhanced v2.2</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }

        /* ìë™ í™•ì¥ textarea ìŠ¤íƒ€ì¼ */
        .auto-resize-textarea {
            resize: none;
            min-height: 80px;
            overflow: hidden;
            transition: all 0.2s ease;
            line-height: 1.8;
        }

        /* ìº¡ì²˜ìš© div ìŠ¤íƒ€ì¼ */
        .capture-text-div {
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.8;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            background-color: #fafafa;
            min-height: 100px;
        }

        /* ì…ë ¥ í•„ë“œ í•œê¸€ ì˜ë¦¼ ë°©ì§€ */
        input[type="text"], textarea {
            line-height: 1.8 !important;
            padding-top: 0.875rem !important;
            padding-bottom: 0.875rem !important;
        }

        /* ì§„í–‰ë¥  ë°” ì• ë‹ˆë©”ì´ì…˜ */
        .progress-fill {
            transition: width 0.5s ease-out;
        }

        /* ì €ì¥ ì¸ë””ì¼€ì´í„° ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(10px); }
            20% { opacity: 1; transform: translateY(0); }
            80% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-10px); }
        }

        .save-indicator {
            animation: fadeInOut 2s ease-out;
        }

        /* í¬ì»¤ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ */
        input:focus, textarea:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
            transition: all 0.2s ease;
        }

        /* ì™„ë£Œëœ í•„ë“œ í‘œì‹œ */
        input.completed, textarea.completed {
            background-color: #f0fdf4;
            border-color: #86efac;
        }

        /* ì¸ì‡„ ìŠ¤íƒ€ì¼ - A4 ê°€ë¡œí˜• 1í˜ì´ì§€ ìµœì í™” */
        @media print {
            @page {
                size: A4 landscape;
                margin: 0.4cm 0.6cm;  /* ì—¬ë°± ë” ì¶•ì†Œ */
            }

            body {
                background: white !important;
                font-size: 9pt !important;
                margin: 0 !important;
                padding: 0 !important;
            }

            .no-print {
                display: none !important;
            }

            /* placeholder í…ìŠ¤íŠ¸ ì™„ì „ ì œê±° */
            input::placeholder,
            textarea::placeholder {
                color: transparent !important;
                opacity: 0 !important;
                visibility: hidden !important;
                display: none !important;
            }

            /* ì „ì²´ ì»¨í…Œì´ë„ˆ ì••ì¶• */
            #capture-area {
                max-width: 100% !important;
                padding: 0 !important;
                box-shadow: none !important;
                margin: 0 !important;
            }

            /* í—¤ë” ìµœì†Œí™” */
            header {
                padding-bottom: 5px !important;
                margin-bottom: 4px !important;
                border-bottom: 1px solid #333 !important;
            }

            header h1 {
                font-size: 15pt !important;
                margin: 0 !important;
            }

            header p {
                font-size: 8pt !important;
                margin: 2px 0 0 0 !important;
            }

            header .text-sm {
                display: none !important;
            }

            /* í•™ìƒ ì •ë³´ ì••ì¶• */
            section:first-of-type {
                margin: 3px 0 !important;
                padding: 0 !important;
            }

            section:first-of-type input {
                width: 50px !important;
                padding: 2px 4px !important;
                height: 20px !important;
                font-size: 8pt !important;
            }

            section:first-of-type input#name {
                width: 70px !important;
            }

            section:first-of-type label {
                font-size: 8pt !important;
            }

            /* í•™ìŠµ ì£¼ì œ ì„¹ì…˜ ì••ì¶• */
            .bg-indigo-50 {
                background-color: #f0f0f0 !important;
                border: 1px solid #666 !important;
                padding: 4px 6px !important;
                margin-bottom: 6px !important;
            }

            .bg-indigo-50 h2 {
                font-size: 10pt !important;
                margin: 0 0 3px 0 !important;
            }

            #topic {
                height: 22px !important;
                padding: 2px 4px !important;
                font-size: 9pt !important;
                background-color: white !important;
            }

            /* ë©”ì¸ ê·¸ë¦¬ë“œ - 2ë‹¨ ì••ì¶• */
            main {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 8px !important;
                margin-bottom: 6px !important;
            }

            /* ê° ì„¹ì…˜ ìŠ¤íƒ€ì¼ ì••ì¶• */
            .bg-orange-50, .bg-green-50 {
                background-color: white !important;
                border: 1.5px solid #333 !important;
                padding: 6px !important;
                page-break-inside: avoid;
            }

            /* ì„¹ì…˜ ì œëª© ì••ì¶• */
            main h2 {
                font-size: 11pt !important;
                margin: 0 0 4px 0 !important;
                padding-bottom: 2px !important;
                border-bottom: 1px solid #333 !important;
            }

            main h3 {
                font-size: 9pt !important;
                margin: 0 0 4px 0 !important;
                font-weight: 600 !important;
            }

            /* ì…ë ¥ í•„ë“œ - í†µí•©ëœ í° í…ìŠ¤íŠ¸ ì˜ì—­ */
            main textarea, .auto-resize-textarea {
                border: 1px solid #666 !important;
                background-color: white !important;
                padding: 4px 6px !important;
                font-size: 9pt !important;
                margin: 0 !important;
                width: 100% !important;
                line-height: 1.4 !important;
            }
            
            /* ê° í…ìŠ¤íŠ¸ ì˜ì—­ë³„ ë†’ì´ ì„¤ì • - 1í˜ì´ì§€ ìµœì í™” */
            [data-field*="words"] {
                height: 55px !important;
                min-height: 55px !important;
                max-height: 55px !important;
            }
            
            [data-field*="questions"] {
                height: 60px !important;
                min-height: 60px !important;
                max-height: 60px !important;
            }
            
            [data-field*="metaphor"] {
                height: 60px !important;
                min-height: 60px !important;
                max-height: 60px !important;
            }

            /* Bridge ì„¹ì…˜ ì••ì¶• */
            .bg-blue-50 {
                background-color: #f0f0f0 !important;
                border: 1.5px solid #333 !important;
                padding: 6px !important;
                margin: 0 !important;
            }

            .bg-blue-50 h2 {
                font-size: 11pt !important;
                margin: 0 0 4px 0 !important;
                padding-bottom: 2px !important;
                border-bottom: 1px solid #333 !important;
            }

            .bg-blue-50 label {
                font-size: 9pt !important;
                margin: 0 0 3px 0 !important;
                display: block !important;
            }

            .bg-blue-50 textarea {
                height: 70px !important;
                min-height: 70px !important;
                max-height: 70px !important;
                background-color: white !important;
            }

            /* ê³µê°„ ìµœì í™” - ë” íƒ€ì´íŠ¸í•˜ê²Œ */
            .space-y-6 > * {
                margin-bottom: 8px !important;
            }

            .space-y-6 > *:last-child {
                margin-bottom: 0 !important;
            }

            /* í˜ì´ì§€ ë‚˜ëˆ„ê¸° ì™„ì „ ë°©ì§€ */
            * {
                page-break-inside: avoid !important;
                page-break-after: avoid !important;
                page-break-before: avoid !important;
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4">
    <div id="capture-area" class="max-w-6xl mx-auto bg-white rounded-xl shadow-lg p-8">
        <!-- í—¤ë” -->
        <header class="text-center pb-6 border-b-2 border-gray-200">
            <h1 class="text-3xl font-bold text-blue-600 mb-2">3-2-1 Bridge</h1>
            <p class="text-gray-600">í•™ìŠµ ì „ê³¼ í›„ì˜ ìƒê°ì„ ì—°ê²°í•˜ì—¬ ì´í•´ì˜ ë³€í™”ë¥¼ í™•ì¸í•˜ëŠ” í™œë™</p>
            <div class="text-sm text-gray-400 mt-2 no-print">Enhanced v2.2</div>
        </header>

        <!-- í•™ìƒ ì •ë³´ -->
        <section class="flex justify-end items-center gap-4 my-6">
            <div class="flex items-center gap-2">
                <label for="grade" class="font-semibold text-gray-700">í•™ë…„:</label>
                <input type="text" id="grade" class="w-16 px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-300">
            </div>
            <div class="flex items-center gap-2">
                <label for="class" class="font-semibold text-gray-700">ë°˜:</label>
                <input type="text" id="class" class="w-16 px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-300">
            </div>
            <div class="flex items-center gap-2">
                <label for="number" class="font-semibold text-gray-700">ë²ˆí˜¸:</label>
                <input type="text" id="number" class="w-16 px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-300">
            </div>
            <div class="flex items-center gap-2">
                <label for="name" class="font-semibold text-gray-700">ì´ë¦„:</label>
                <input type="text" id="name" class="w-24 px-3 py-2 border rounded-md focus:ring-2 focus:ring-blue-300">
            </div>
        </section>

        <!-- í•™ìŠµ ì£¼ì œ (CSIì—ì„œ ê°€ì ¸ì˜¨ ê¸°ëŠ¥) -->
        <section class="mb-8">
            <div class="bg-indigo-50 p-5 rounded-lg border border-indigo-200">
                <h2 class="text-xl font-bold text-indigo-800 mb-3">í•™ìŠµ ì£¼ì œ</h2>
                <input type="text" id="topic" 
                    class="w-full px-4 py-3 border-2 border-indigo-300 rounded-md bg-white focus:border-indigo-500 transition-colors"
                    placeholder="ì˜¤ëŠ˜ì˜ í•™ìŠµ ì£¼ì œë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
            </div>
        </section>

        <!-- ë©”ì¸ ì½˜í…ì¸  -->
        <main class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <!-- í•™ìŠµ ì „ -->
            <section class="bg-orange-50 p-6 rounded-lg border border-orange-200">
                <h2 class="text-2xl font-bold text-orange-600 mb-4 pb-2 border-b-2 border-orange-300">
                    Initial Response (í•™ìŠµ ì „)
                </h2>
                
                <div class="space-y-6">
                    <!-- 3 Words -->
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-3">
                            3 Words: í•µì‹¬ ë‹¨ì–´ 3ê°€ì§€
                        </h3>
                        <textarea class="auto-resize-textarea w-full px-3 py-2 border rounded-md" 
                            placeholder="3ê°œì˜ í•µì‹¬ ë‹¨ì–´ë¥¼ ì ì–´ì£¼ì„¸ìš”" 
                            data-field="initial-words"></textarea>
                    </div>

                    <!-- 2 Questions -->
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-3">
                            2 Questions: ì§ˆë¬¸ 2ê°€ì§€
                        </h3>
                        <textarea class="auto-resize-textarea w-full px-3 py-2 border rounded-md" 
                            placeholder="2ê°œì˜ ì§ˆë¬¸ì„ ì ì–´ì£¼ì„¸ìš”" 
                            data-field="initial-questions"></textarea>
                    </div>

                    <!-- 1 Metaphor -->
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-3">
                            1 Metaphor/Simile: ë¹„ìœ  1ê°€ì§€
                        </h3>
                        <textarea class="auto-resize-textarea w-full px-3 py-2 border rounded-md" 
                            placeholder="'OO'ì€ ë§ˆì¹˜ 'XX' ê°™ë‹¤. ì™œëƒí•˜ë©´..." 
                            data-field="initial-metaphor"></textarea>
                    </div>
                </div>
            </section>

            <!-- í•™ìŠµ í›„ -->
            <section class="bg-green-50 p-6 rounded-lg border border-green-200">
                <h2 class="text-2xl font-bold text-green-600 mb-4 pb-2 border-b-2 border-green-300">
                    New Response (í•™ìŠµ í›„)
                </h2>
                
                <div class="space-y-6">
                    <!-- 3 Words -->
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-3">
                            3 Words: í•µì‹¬ ë‹¨ì–´ 3ê°€ì§€
                        </h3>
                        <textarea class="auto-resize-textarea w-full px-3 py-2 border rounded-md" 
                            placeholder="3ê°œì˜ í•µì‹¬ ë‹¨ì–´ë¥¼ ì ì–´ì£¼ì„¸ìš”" 
                            data-field="new-words"></textarea>
                    </div>

                    <!-- 2 Questions -->
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-3">
                            2 Questions: ì§ˆë¬¸ 2ê°€ì§€
                        </h3>
                        <textarea class="auto-resize-textarea w-full px-3 py-2 border rounded-md" 
                            placeholder="2ê°œì˜ ì§ˆë¬¸ì„ ì ì–´ì£¼ì„¸ìš”" 
                            data-field="new-questions"></textarea>
                    </div>

                    <!-- 1 Metaphor -->
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-3">
                            1 Metaphor/Simile: ë¹„ìœ  1ê°€ì§€
                        </h3>
                        <textarea class="auto-resize-textarea w-full px-3 py-2 border rounded-md" 
                            placeholder="'OO'ì€ ë§ˆì¹˜ 'XX' ê°™ë‹¤. ì™œëƒí•˜ë©´..." 
                            data-field="new-metaphor"></textarea>
                    </div>
                </div>
            </section>
        </main>

        <!-- Bridge ì„¹ì…˜ -->
        <section class="bg-blue-50 p-6 rounded-lg border border-blue-200 mb-8">
            <h2 class="text-2xl font-bold text-blue-600 mb-4 pb-2 border-b-2 border-blue-300">
                Bridge: ìƒê°ì˜ ë‹¤ë¦¬ ë†“ê¸°
            </h2>
            <label for="bridge-text" class="block font-semibold text-gray-800 mb-3">
                í•™ìŠµ ì „ì—ì„œ í›„ë¡œ ë‹¹ì‹ ì˜ ìƒê°ì€ ì–´ë–»ê²Œ, ê·¸ë¦¬ê³  ì™œ ë°”ë€Œì—ˆë‚˜ìš”?
            </label>
            <textarea id="bridge-text" class="auto-resize-textarea w-full px-3 py-2 border rounded-md" 
                placeholder="ì²˜ìŒ ìƒê°ì€ ...ì˜€ì§€ë§Œ, ë°°ìš°ê³  ë‚˜ì„œ ...ë¼ê³  ë°”ë€Œì—ˆë‹¤. ì™œëƒí•˜ë©´..."
                data-field="bridge"></textarea>
        </section>

        <!-- ì§„í–‰ë¥  í‘œì‹œ (ìƒˆë¡œìš´ ê¸°ëŠ¥) -->
        <div class="no-print fixed bottom-4 left-4 bg-white p-4 rounded-lg shadow-lg">
            <div class="flex items-center gap-3">
                <div class="text-sm font-semibold text-gray-600">ì™„ì„±ë„</div>
                <div class="w-32 bg-gray-200 rounded-full h-2">
                    <div id="progress-bar" class="progress-fill bg-green-500 h-2 rounded-full" style="width: 0%"></div>
                </div>
                <div id="progress-text" class="text-sm font-semibold text-gray-600">0%</div>
            </div>
        </div>

        <!-- ì €ì¥ ìƒíƒœ í‘œì‹œ -->
        <div id="save-indicator" class="no-print fixed bottom-4 right-4 hidden">
            <div class="save-indicator bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
                ìë™ ì €ì¥ë¨
            </div>
        </div>

        <!-- ë²„íŠ¼ ì˜ì—­ -->
        <footer class="no-print mt-10 pt-6 border-t-2 border-gray-200">
            <!-- í•™ìƒìš© ë²„íŠ¼ -->
            <div class="text-center mb-6">
                <p class="text-sm font-semibold text-green-600 mb-3">
                    ğŸ’¡ í•™ìƒìš©: ì‘ì„±í•œ ë‚´ìš©ì„ ì´ë¯¸ì§€ë¡œ ì €ì¥í•˜ì„¸ìš”
                </p>
                <div class="flex justify-center gap-3">
                    <button onclick="downloadAsImage()" 
                        class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg transition-colors flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        ì´ë¯¸ì§€ë¡œ ì €ì¥
                    </button>
                    <button onclick="resetForm()" 
                        class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg transition-colors flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        ì´ˆê¸°í™”
                    </button>
                </div>
            </div>

            <!-- êµì‚¬ìš© ë²„íŠ¼ -->
            <div class="bg-gray-50 p-4 rounded-lg text-center">
                <p class="text-sm font-semibold text-gray-600 mb-3">
                    ğŸ“‹ êµì‚¬ìš©: A4 ê°€ë¡œí˜• 1í˜ì´ì§€ ì¸ì‡„
                </p>
                <button onclick="window.print()" 
                    class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-6 rounded-lg transition-colors flex items-center gap-2 mx-auto">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                    </svg>
                    A4 ê°€ë¡œí˜• ì¸ì‡„
                </button>
                <p class="text-xs text-gray-500 mt-2">
                    â€» ì¸ì‡„ ì„¤ì •ì—ì„œ 'ê°€ë¡œ' ë°©í–¥ì„ ì„ íƒí•˜ì„¸ìš”
                </p>
            </div>

            <!-- ê°œì„ ì‚¬í•­ ì•ˆë‚´ -->
            <div class="mt-6 text-center text-xs text-gray-400">
                âœ¨ v2.2 ê°œì„ ì‚¬í•­: 1í˜ì´ì§€ ì™„ë²½ ìµœì í™” + í†µí•© ì…ë ¥ì¹¸ + ì ì ˆí•œ ì‘ì„± ê³µê°„
            </div>
        </footer>
    </div>

    <!-- ë¡œë”© í‘œì‹œ -->
    <div id="loading" class="no-print hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg shadow-xl flex items-center gap-3">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <span class="text-lg font-semibold">ì´ë¯¸ì§€ ìƒì„± ì¤‘...</span>
        </div>
    </div>

    <script>
        // ìƒìˆ˜ ì •ì˜
        const STORAGE_KEY = '3-2-1-bridge-enhanced-v2.2';
        let saveTimeout;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            setupAutoResizeTextareas();
            setupAutoSave();
            setupProgressTracking();
            setupEnterKeyNavigation();
            loadSavedData();
            updateProgress();
            
            // ì²« ë²ˆì§¸ ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
            document.getElementById('grade')?.focus();
        });

        // ìë™ ë†’ì´ ì¡°ì • ì„¤ì • (CSIì—ì„œ ê°€ì ¸ì˜¨ í•µì‹¬ ê¸°ëŠ¥)
        function setupAutoResizeTextareas() {
            const textareas = document.querySelectorAll('.auto-resize-textarea');
            
            textareas.forEach(textarea => {
                function autoResize() {
                    textarea.style.height = 'auto';
                    const newHeight = Math.max(80, textarea.scrollHeight + 2);
                    textarea.style.height = newHeight + 'px';
                }
                
                textarea.addEventListener('input', autoResize);
                textarea.addEventListener('paste', () => setTimeout(autoResize, 10));
                textarea.addEventListener('focus', autoResize);
                
                // ì´ˆê¸° ë†’ì´ ì„¤ì •
                if (textarea.value) {
                    setTimeout(autoResize, 100);
                }
            });
        }

        // ìë™ ì €ì¥ ì„¤ì •
        function setupAutoSave() {
            const inputs = document.querySelectorAll('input[type="text"], textarea');
            
            inputs.forEach(input => {
                input.addEventListener('input', () => {
                    autoSave();
                    updateProgress();
                    
                    // í•„ë“œ ì™„ë£Œ í‘œì‹œ
                    if (input.value.trim()) {
                        input.classList.add('completed');
                    } else {
                        input.classList.remove('completed');
                    }
                });
            });
        }

        // ìë™ ì €ì¥ í•¨ìˆ˜
        function autoSave() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                const formData = {
                    timestamp: new Date().toISOString(),
                    data: {}
                };
                
                document.querySelectorAll('[data-field]').forEach(element => {
                    const field = element.getAttribute('data-field');
                    formData.data[field] = element.value;
                });
                
                // í•™ìƒ ì •ë³´ë„ ì €ì¥
                ['grade', 'class', 'number', 'name', 'topic'].forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        formData.data[id] = element.value;
                    }
                });
                
                localStorage.setItem(STORAGE_KEY, JSON.stringify(formData));
                showSaveIndicator();
            }, 500);
        }

        // ì €ì¥ ìƒíƒœ í‘œì‹œ
        function showSaveIndicator() {
            const indicator = document.getElementById('save-indicator');
            indicator.classList.remove('hidden');
            setTimeout(() => {
                indicator.classList.add('hidden');
            }, 2000);
        }

        // ì €ì¥ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        function loadSavedData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                const formData = JSON.parse(saved);
                
                // í•„ë“œë³„ ë°ì´í„° ë³µì›
                Object.keys(formData.data).forEach(field => {
                    const element = document.querySelector(`[data-field="${field}"]`) || 
                                  document.getElementById(field);
                    if (element) {
                        element.value = formData.data[field];
                        if (element.value.trim()) {
                            element.classList.add('completed');
                        }
                        
                        // textarea ë†’ì´ ì¡°ì •
                        if (element.classList.contains('auto-resize-textarea')) {
                            element.style.height = 'auto';
                            element.style.height = element.scrollHeight + 'px';
                        }
                    }
                });
            }
        }

        // ì§„í–‰ë¥  ì¶”ì  ì„¤ì •
        function setupProgressTracking() {
            updateProgress();
        }

        // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
        function updateProgress() {
            const allFields = document.querySelectorAll('input[type="text"], textarea');
            const filledFields = Array.from(allFields).filter(field => field.value.trim()).length;
            const totalFields = allFields.length;
            const percentage = Math.round((filledFields / totalFields) * 100);
            
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            
            progressBar.style.width = percentage + '%';
            progressText.textContent = percentage + '%';
            
            // ìƒ‰ìƒ ë³€ê²½
            if (percentage < 33) {
                progressBar.className = 'progress-fill bg-red-500 h-2 rounded-full';
            } else if (percentage < 66) {
                progressBar.className = 'progress-fill bg-yellow-500 h-2 rounded-full';
            } else {
                progressBar.className = 'progress-fill bg-green-500 h-2 rounded-full';
            }
        }

        // Enter í‚¤ ë„¤ë¹„ê²Œì´ì…˜ ì„¤ì •
        function setupEnterKeyNavigation() {
            const inputs = document.querySelectorAll('input[type="text"], textarea');
            
            inputs.forEach((input, index) => {
                if (input.tagName === 'INPUT') {
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            const nextInput = inputs[index + 1];
                            if (nextInput) {
                                nextInput.focus();
                                if (nextInput.tagName === 'TEXTAREA') {
                                    nextInput.setSelectionRange(0, 0);
                                }
                            }
                        }
                    });
                }
            });
        }

        // ê°œì„ ëœ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ (CSIì˜ ì¤„ë°”ê¿ˆ ë³´ì¡´ ê¸°ë²• ì ìš©)
        async function downloadAsImage() {
            const loading = document.getElementById('loading');
            const captureArea = document.getElementById('capture-area');
            
            loading.classList.remove('hidden');
            
            // textarea ë°±ì—…
            const textareaBackups = [];
            const textareas = captureArea.querySelectorAll('.auto-resize-textarea');
            
            try {
                // textareaë¥¼ divë¡œ ì„ì‹œ ë³€í™˜
                textareas.forEach(textarea => {
                    textareaBackups.push({
                        element: textarea,
                        parent: textarea.parentNode,
                        value: textarea.value
                    });
                    
                    const captureDiv = document.createElement('div');
                    captureDiv.className = 'capture-text-div';
                    captureDiv.textContent = textarea.value || textarea.placeholder;
                    
                    if (!textarea.value && textarea.placeholder) {
                        captureDiv.style.color = '#9ca3af';
                        captureDiv.style.fontStyle = 'italic';
                    }
                    
                    textarea.parentNode.replaceChild(captureDiv, textarea);
                });
                
                // ë²„íŠ¼ ì˜ì—­ ìˆ¨ê¸°ê¸°
                document.querySelector('footer').style.display = 'none';
                
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // ìº¡ì²˜ ì‹¤í–‰
                const canvas = await html2canvas(captureArea, {
                    scale: 2,
                    backgroundColor: '#ffffff',
                    logging: false,
                    useCORS: true
                });
                
                // ë‹¤ìš´ë¡œë“œ
                const link = document.createElement('a');
                const studentName = document.getElementById('name').value || 'í•™ìƒ';
                const topic = document.getElementById('topic').value || 'ì£¼ì œ';
                const date = new Date().toISOString().split('T')[0];
                
                const cleanTopic = topic.substring(0, 20).replace(/[^ê°€-í£a-zA-Z0-9]/g, '');
                link.download = `3-2-1_Bridge_${cleanTopic}_${studentName}_${date}.png`;
                link.href = canvas.toDataURL('image/png', 1.0);
                link.click();
                
                showNotification('âœ¨ ì´ë¯¸ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                
            } catch (error) {
                console.error('ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì˜¤ë¥˜:', error);
                showNotification('âŒ ì´ë¯¸ì§€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.', 'error');
            } finally {
                // ì›ë˜ ìƒíƒœë¡œ ë³µì›
                textareaBackups.forEach(backup => {
                    const currentDiv = backup.parent.querySelector('.capture-text-div');
                    if (currentDiv) {
                        backup.parent.replaceChild(backup.element, currentDiv);
                        backup.element.value = backup.value;
                    }
                });
                
                document.querySelector('footer').style.display = '';
                loading.classList.add('hidden');
                
                // textarea ë†’ì´ ì¬ì¡°ì •
                setupAutoResizeTextareas();
            }
        }

        // í¼ ì´ˆê¸°í™”
        function resetForm() {
            if (confirm('ì‘ì„±í•œ ëª¨ë“  ë‚´ìš©ì´ ì§€ì›Œì§‘ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ëª¨ë“  ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
                document.querySelectorAll('input[type="text"], textarea').forEach(input => {
                    input.value = '';
                    input.classList.remove('completed');
                    if (input.classList.contains('auto-resize-textarea')) {
                        input.style.height = '80px';
                    }
                });
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚­ì œ
                localStorage.removeItem(STORAGE_KEY);
                
                // ì§„í–‰ë¥  ì´ˆê¸°í™”
                updateProgress();
                
                // ì²« ë²ˆì§¸ í•„ë“œë¡œ í¬ì»¤ìŠ¤
                document.getElementById('grade')?.focus();
                
                showNotification('ğŸ”„ ëª¨ë“  ë‚´ìš©ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            
            notification.className = `fixed top-5 right-5 ${bgColor} text-white py-3 px-6 rounded-lg shadow-lg z-50 flex items-center gap-2`;
            notification.innerHTML = `
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                notification.style.transition = 'all 0.3s ease-out';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    </script>
</body>
</html>
